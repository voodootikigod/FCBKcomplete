(function(f){f.fn.extend({fcbkcomplete:function(i){i=f.extend({},f.FCBKCompleter.defaults,i);return this.each(function(){new f.FCBKCompleter(this,i)})},addItem:function(i,c){return this.trigger("addItem",[i,c])}});f.FCBKCompleter=function(i,c){var p={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8,FORWARD_SLASH:191},m=null,d=null,l=null,w=0,q=[],D=false,v="",g=null,y=0,r=false,s,E=false,j=f(i),x=j.attr("id");M();N();F(0);i={};for(var o=0;o<c.sep_keycodes.length;o++){var O=
c.sep_keycodes[o];i[O]=true}c.sep_keycodes=i;j.bind("addItem",function(a,b,e){t(b,e)});function M(){j.hide();j.attr("multiple","multiple");j.attr("name").indexOf("[]")==-1&&j.attr("name",j.attr("name")+"[]");m=f(document.createElement("ul"));m.attr("class",c.holder_class);j.after(m);l=f(document.createElement("div"));l.addClass(c.results_class);l.append('<div class="default">'+c.complete_text+"</div>");if(r){l.append('<iframe class="ie6fix" scrolling="no" frameborder="0"></iframe>');s=l.children(".ie6fix")}d=
f(document.createElement("ul"));d.attr("id",x+"_feed");l.prepend(d);m.after(l);d.css("width",l.width())}function N(){j.children(":selected").addClass("selected");j.children("option").each(function(a,b){a=f(b);q.push(c.cache_object(a));v+=""+(q.length-1)+":"+a.text()+";"});j.children(".selected").each(function(a,b){a=f(b);t(a.text(),a.val(),true)})}function t(a,b,e){a=a.replace(/^ */,"").replace(/ *$/,"");if(a===""){if(m.find(".bit-input input").length>0)m.find(".bit-input input")[0].value=""}else{var h=
document.createElement("li"),k=document.createTextNode(a),u=document.createElement("a");f(h).attr({"class":"bit-box",rel:b});f(h).prepend(k);f(h).click(function(){f(this).toggleClass("deleted")});f(u).attr({"class":"closebutton",href:"#"});h.appendChild(u);m.append(h);f(u).click(function(){f(this).parent("li").fadeOut("fast",function(){G(f(this))});return false});if(!e){f("#"+x+"_annoninput").remove();var n;F(1);if(j.children("option[value="+b+"]").length){n=j.children("option[value="+b+"]");n.get(0).setAttribute("selected",
"selected");n.hasClass("selected")||n.addClass("selected")}else{n=f(document.createElement("option"));n.attr("value",b).get(0).setAttribute("selected","selected");n.attr("value",b).addClass("selected");n.text(a);j.append(n)}c.onselect.length&&H(c.onselect,n)}m.children("li.bit-box.deleted").removeClass("deleted");d.hide();r&&s.hide()}}function G(a){if(c.onremove.length){var b=j.children("option[value="+a.attr("rel")+"]");H(c.onremove,b)}j.children("option[value="+a.attr("rel")+"]").removeAttr("selected");
j.children("option[value="+a.attr("rel")+"]").removeClass("selected");a.remove();y=0}function F(a){var b=f(document.createElement("li")),e=f(document.createElement("input"));b.attr({"class":"bit-input",id:x+"_annoninput"});e.attr({type:"text","class":"maininput",size:"1"});m.append(b.append(e));e.focus(function(){l.fadeIn("fast")});e.blur(function(){var h=z(f(this).val());h&&c.accept_on_blur&&t(h,h);l.fadeOut("fast")});m.click(function(){e.focus();if(d.length&&e.val().length)d.show();else{d.hide();
r&&s.hide();l.children(".default").show()}});e.keypress(function(h){if(A(h.keyCode))return false;e.attr("size",e.val().length+1)});e.keydown(function(h){if(h.keyCode==p.FORWARD_SLASH){h.preventDefault();return false}});e.keyup(function(h){var k=z(e.val());if(h.keyCode==p.BACKSPACE&&k.length==0){d.hide();r&&s.hide();if(m.children("li.bit-box.deleted").length==0){m.children("li.bit-box:last").addClass("deleted");return false}else{if(y)return;y=1;m.children("li.bit-box.deleted").fadeOut("fast",function(){G(f(this));
return false})}}if(h.keyCode!=p.DOWN&&h.keyCode!=p.UP&&k.length!=0){w=0;if(c.json_url)if(c.cache&&D){B(k);C()}else{clearTimeout(E);E=setTimeout(function(){f.getJSON(c.json_url+"?tag="+k,null,function(u){B(k,u);D=true;C()})},c.delay)}else{B(k);C()}l.children(".default").hide();d.show()}});a&&setTimeout(function(){e.focus();l.children(".default").show()},1)}function B(a,b){d.html("");if(!c.cache){q=[];v=""}P(a);b!=null&&b.length&&f.each(b,function(n,I){q.push(c.cache_object(I));v+=""+(q.length-1)+":"+
c.to_search_string(I)+";"});b=c.maxshownitems<q.length?c.maxshownitems:q.length;var e="i";if(c.filter_case)e="";var h,k;try{h=eval("/(?:^|;)\\s*(\\d+)\\s*:[^;]*?"+a+"[^;]*/g"+e);k=h.exec(v)}catch(u){}for(a="";k!=null&&b>0;){k=k[1];k=q[k];if(!(c.filter_selected&&j.children("option[value="+k.value+"]").hasClass("selected"))){a+=c.render_cache_object(k);w++;b--}k=h.exec(v)}d.append(a);if(c.firstselected){g=d.children("li:visible:first");g.addClass("auto-focus")}if(w>c.height){d.css({height:c.height*
24+"px",overflow:"auto"});r&&s.css({height:c.height*24+"px",width:d.width()+"px"}).show()}else{d.css("height","auto");r&&s.css({height:d.height()+"px",width:d.width()+"px"}).show()}}function J(){d.children("li").mouseover(function(){d.children("li").removeClass("auto-focus");f(this).addClass("auto-focus");g=f(this)});d.children("li").mouseout(function(){f(this).removeClass("auto-focus");g=null})}function K(){d.children("li").unbind("mouseover");d.children("li").unbind("mouseout");d.mousemove(function(){J();
d.unbind("mousemove")})}function C(){var a=f("#"+x+"_annoninput").children(".maininput");J();d.children("li").unbind("mousedown");d.children("li").mousedown(function(){var b=f(this);t(c.item_text(b),b.attr("rel"));d.hide();r&&s.hide();l.hide()});a.unbind("keydown");a.keydown(function(b){if(b.keyCode==p.FORWARD_SLASH){b.preventDefault();return false}b.keyCode!=p.BACKSPACE&&m.children("li.bit-box.deleted").removeClass("deleted");if(A(b.keyCode)&&L()){var e=g;t(c.item_text(e),e.attr("rel"));l.hide();
b.preventDefault();g=null;return false}if(A(b.keyCode)&&!L()){if(c.newel){e=z(f(this).val());t(e,e);l.hide();b.preventDefault();g=null}return false}if(b.keyCode==p.DOWN){K();if(g==null||g.length==0){g=d.children("li:visible:first");d.get(0).scrollTop=0}else{g.removeClass("auto-focus");g=g.nextAll("li:visible:first");e=parseInt(g.prevAll("li:visible").length,10);var h=parseInt(g.nextAll("li:visible").length,10);if((e>Math.round(c.height/2)||h<=Math.round(c.height/2))&&typeof g.get(0)!="undefined")d.get(0).scrollTop=
parseInt(g.get(0).scrollHeight,10)*(e-Math.round(c.height/2))}d.children("li").removeClass("auto-focus");g.addClass("auto-focus")}if(b.keyCode==p.UP){K();if(g==null||g.length==0){g=d.children("li:visible:last");d.get(0).scrollTop=parseInt(g.get(0).scrollHeight,10)*(parseInt(d.children("li:visible").length,10)-Math.round(c.height/2))}else{g.removeClass("auto-focus");g=g.prevAll("li:visible:first");e=parseInt(g.prevAll("li:visible").length,10);h=parseInt(g.nextAll("li:visible").length,10);if((h>Math.round(c.height/
2)||e<=Math.round(c.height/2))&&typeof g.get(0)!="undefined")d.get(0).scrollTop=parseInt(g.get(0).scrollHeight,10)*(e-Math.round(c.height/2))}d.children("li").removeClass("auto-focus");g.addClass("auto-focus")}})}function P(a){if(c.newel){d.children("li[fckb=1]").remove();if(a.length!=0){var b=f(document.createElement("li"));b.attr({rel:a,fckb:"1"}).html(a);d.prepend(b);w++}}}function H(a,b){var e="";for(o=0;o<b.get(0).attributes.length;o++)if(b.get(0).attributes[o].nodeValue!=null)e+='"_'+b.get(0).attributes[o].nodeName+
'": "'+b.get(0).attributes[o].nodeValue+'",';e="{"+e+" notinuse: 0}";try{eval(a+"("+e+")")}catch(h){}}function L(){if(g==null)return false;if(g.length==0)return false;return true}function z(a){a=a.replace(/[\"\'][\s]*javascript:(.*)[\"\']/g,'""');a=a.replace(/script(.*)/g,"");a=a.replace(/eval\((.*)\)/g,"");return a=a.replace("/([\u0000-\u0008,\u000b-\u000c,\u000e-\u0019])/","")}function A(a){return c.sep_keycodes[a]===true}};f.FCBKCompleter.defaults={holder_class:"holder",results_class:"facebook-auto",
complete_text:"Start to type...",accept_on_blur:false,cache:true,filter_case:false,filter_hide:false,firstselected:false,height:"10",json_url:null,maxshownitems:20,newel:false,onselect:"",onremove:"",delay:500,sep_keycodes:[13],item_text:function(i){return i.text()},to_search_string:function(i){return i.caption},render_cache_object:function(i){return'<li rel="'+i.value+'">'+itemIllumination(i.caption,etext)+"</li>"},cache_object:function(i){return i.caption?{caption:i.caption,value:i.value}:{caption:i.text(),
value:i.val()}}}})(jQuery);
